---
import "../styles/global.css";
import "../styles/app.css";
import SiteLoader from "../components/SiteLoader.astro";
import SiteFooter from "../components/SiteFooter.astro";

interface Props {
  title?: string;
  description?: string;
  view?: "default" | "timeline" | "holodeck" | "experiences";
}

const {
  title = "Willows Bell",
  description = "Interactive journal of software projects and posts.",
  view = "default"
} = Astro.props;

const path = Astro.url.pathname.replace(/\/+$/, "") || "/";
const isActive = (target: string) => {
  const clean = target.replace(/\/+$/, "") || "/";
  return path === clean || (clean !== "/" && path.startsWith(`${clean}/`));
};
const isInteractive = view === "timeline" || view === "holodeck" || view === "experiences";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />
  </head>
  <body class={`app view-${view}`}>
    <SiteLoader />
    <header class="topbar">
      <a class="brand" href="/">Willows Bell</a>
      <button class="hamburger" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
      <nav class="topnav">
        <a class={isActive("/") ? "active" : ""} href="/">Home</a>
        <a class={isActive("/experiences") ? "active" : ""} href="/experiences/">Experiences</a>
        <a class={isActive("/projects") ? "active" : ""} href="/projects/">Projects</a>
        <a class={isActive("/posts") ? "active" : ""} href="/posts/">Posts</a>
        <a class={isActive("/about") ? "active" : ""} href="/about/">About</a>
      </nav>
    </header>
    <div class="wip-banner">
      ðŸš§ This site is a work in progress. Some features may be incomplete or change.
    </div>
    <script>
      const btn = document.querySelector('.hamburger');
      const nav = document.querySelector('.topnav');
      btn?.addEventListener('click', () => {
        const open = btn.classList.toggle('is-open');
        nav?.classList.toggle('is-open', open);
        btn.setAttribute('aria-expanded', String(open));
      });
      nav?.querySelectorAll('a').forEach(a => a.addEventListener('click', () => {
        btn?.classList.remove('is-open');
        nav?.classList.remove('is-open');
        btn?.setAttribute('aria-expanded', 'false');
      }));
    </script>
    <main class="app-main">
      <slot />
    </main>
    {!isInteractive && <SiteFooter github="https://github.com" linkedin="https://linkedin.com" />}
  </body>
</html>
